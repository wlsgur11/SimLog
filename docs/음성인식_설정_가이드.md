# Naver Clova 음성인식 설정 가이드

## 개요
SimLog에서 Naver Clova Speech Recognition API를 사용하여 음성을 텍스트로 변환하는 기능을 제공합니다.

## 1. Naver Cloud Platform 설정

### 1.1 NCP 계정 생성
1. [Naver Cloud Platform](https://www.ncloud.com/)에 가입
2. 본인인증 및 결제 수단 등록

### 1.2 Speech Recognition 서비스 활성화
1. NCP 콘솔에서 **AI·NAVER API** → **Speech Recognition** 선택
2. 서비스 신청 및 활성화

### 1.3 API 키 생성
1. **AI·NAVER API** → **Speech Recognition** → **Application** 메뉴
2. **Application 등록** 클릭
3. Application 이름 입력 (예: "SimLog-STT")
4. 생성된 **Client ID**와 **Client Secret** 복사

## 2. 환경 변수 설정

### 2.1 백엔드 .env 파일 설정
`backend/.env` 파일에 다음 내용을 추가:

```bash
# NAVER CLOVA Speech Recognition
CLOVA_CLIENT_ID=your-clova-client-id-here
CLOVA_CLIENT_SECRET=your-clova-client-secret-here
```

### 2.2 환경 변수 확인
백엔드 서버 시작 시 로그에서 다음 메시지 확인:
```
Naver Clova API 키가 설정되지 않았습니다.
CLOVA_CLIENT_ID: your-client-id
CLOVA_CLIENT_SECRET: your-client-secret
```

## 3. 음성인식 사용 방법

### 3.1 웹 브라우저에서 사용
- **지원됨**: MediaRecorder API를 사용한 음성 녹음 및 Clova STT 연동
- **지원 브라우저**: Chrome, Edge, Firefox, Safari (최신 버전)
- **사용법**: 마이크 아이콘 탭 → 녹음 시작 → 다시 탭하여 중지 → 자동 음성인식
- **주의사항**: HTTPS 환경에서만 작동 (보안 정책)
- **권한**: 브라우저에서 마이크 접근 권한 허용 필요

### 3.2 모바일 앱에서 사용
1. 일기 작성 화면에서 마이크 아이콘 탭
2. 녹음 시작 (마이크 권한 허용 필요)
3. 다시 탭하여 녹음 중지
4. 음성이 텍스트로 변환되어 입력창에 추가

## 4. 문제 해결

### 4.1 "Naver Clova API 키가 설정되지 않았습니다" 오류
**원인**: 환경 변수가 제대로 설정되지 않음
**해결방법**:
1. `.env` 파일에 올바른 API 키 입력
2. 백엔드 서버 재시작
3. 환경 변수 이름 확인 (`CLOVA_CLIENT_ID`, `CLOVA_CLIENT_SECRET`)

### 4.2 "웹 녹음 시작 실패" 오류
**원인**: 브라우저에서 MediaRecorder API 지원하지 않거나 권한 거부
**해결방법**:
1. Chrome, Edge, Firefox, Safari 최신 버전 사용
2. HTTPS 환경에서 접속 (http://localhost는 예외)
3. 브라우저에서 마이크 권한 허용
4. 마이크가 연결되어 있는지 확인

### 4.3 "웹 녹음 중지 실패" 오류
**원인**: MediaRecorder 상태 오류 또는 브라우저 호환성 문제
**해결방법**:
1. 페이지 새로고침 후 다시 시도
2. 다른 브라우저에서 테스트
3. 브라우저 개발자 도구에서 콘솔 오류 확인

### 4.4 "STT API 오류: 401" 오류
**원인**: API 키가 잘못되었거나 만료됨
**해결방법**:
1. NCP 콘솔에서 API 키 재확인
2. Application 상태 확인
3. 결제 상태 확인

### 4.5 "STT API 오류: 413" 오류
**원인**: 오디오 파일이 너무 큼 (10MB 제한)
**해결방법**:
1. 더 짧은 음성 녹음
2. 오디오 품질 조정

## 5. API 사용량 및 비용

### 5.1 무료 사용량
- 월 1,000건 무료
- 초당 0.1원 (약 10초당 1원)

### 5.2 사용량 확인
1. NCP 콘솔 → **AI·NAVER API** → **Speech Recognition**
2. **Usage** 메뉴에서 사용량 확인

## 6. 개발자 모드

### 6.1 개발자 계정으로 테스트
```bash
# 개발자 계정 생성
python create_developer.py

# 로그인 정보
Email: developer@simlog.com
Password: dev1234!
```

### 6.2 API 테스트
```bash
# Swagger UI에서 테스트
http://localhost:8000/docs

# 음성인식 API 엔드포인트
POST /voice/stt
```

## 7. 보안 주의사항

### 7.1 API 키 보안
- `.env` 파일을 Git에 커밋하지 않음
- API 키를 코드에 하드코딩하지 않음
- 프로덕션 환경에서는 환경 변수 사용

### 7.2 파일 업로드 제한
- 오디오 파일 크기: 최대 10MB
- 지원 형식: WAV, MP3, M4A 등
- 권장 샘플링 레이트: 16kHz

## 8. 성능 최적화

### 8.1 오디오 품질 설정
```dart
// Flutter에서 권장 설정
RecordConfig(
  encoder: AudioEncoder.wav,
  bitRate: 128000,
  sampleRate: 16000,
)
```

### 8.2 네트워크 최적화
- 오디오 파일 압축
- 적절한 파일 크기 유지
- 네트워크 상태 확인

## 9. 추가 리소스

### 9.1 공식 문서
- [Naver Clova Speech Recognition API 문서](https://api.ncloud-docs.com/docs/ai-naver-clovarecognition-stt)
- [NCP 콘솔 가이드](https://guide.ncloud-docs.com/docs/ko/home)

### 9.2 지원
- NCP 고객센터: 1544-4799
- 기술 문의: [NCP 기술지원](https://www.ncloud.com/support) 